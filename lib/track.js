!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("moment")):"function"==typeof define&&define.amd?define(["moment"],e):(t=t||self).track=e(t.moment)}(this,(function(t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var e={appkey:"5d870d087ea72250dc0c5099",uploadUrl:"/api/log/csi",router:"hash",autoTrack:!1,autoHeatmap:!1,autoVisual:!1,autoHash:!0,session:"crossDomain"},n="BCE_MONITOR_PAGE_SESSION",a=function(){return(a=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=new(function(){function t(){}return t.prototype.set=function(t,e,n){if(void 0===n&&(n={}),t){var a=n.expires;u(a)&&(a=new Date).setTime(a.getTime()+ +n.expires),document.cookie=t+"="+(n.raw?e:encodeURIComponent(e))+(a instanceof Date?"; expires="+a.toUTCString():"")+(n.domain?"; domain="+n.domain:"")+(n.path?"; path="+n.path:"")+(n.secure?"; secure":"")}},t.prototype.get=function(t,e){if(void 0===e&&(e={}),t){var n=String(document.cookie).match(new RegExp("(?:^|)"+t+"(?:(?:=([^;]*))|;|$)"));if(n)return n[1]?e.raw?n[1]:decodeURIComponent(n[1]):""}return null},t.prototype.remove=function(t,e){void 0===e&&(e={}),e.raw=!0,e.expires=new Date(0),this.set(t,"",e)},t}()),i=function(){var t=navigator.userAgent,e="Win32"==navigator.platform||"Windows"==navigator.platform,n="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(n)return"Mac";if("X11"==navigator.platform&&!e&&!n)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(e){if(t.indexOf("Windows NT 5.0")>-1||t.indexOf("Windows 2000")>-1)return"Win2000";if(t.indexOf("Windows NT 5.1")>-1||t.indexOf("Windows XP")>-1)return"WinXP";if(t.indexOf("Windows NT 5.2")>-1||t.indexOf("Windows 2003")>-1)return"Win2003";if(t.indexOf("Windows NT 6.0")>-1||t.indexOf("Windows Vista")>-1)return"WinVista";if(t.indexOf("Windows NT 6.1")>-1||t.indexOf("Windows 7")>-1)return"Win7";if(t.indexOf("Windows NT 10")>-1||t.indexOf("Windows 10")>-1)return"Win10"}return"other"},r=function(){var t,e={},n=navigator.userAgent.toLowerCase();(t=n.match(/msie ([\d.]+)/))?e.ie=t[1]:(t=n.match(/firefox\/([\d.]+)/))?e.firefox=t[1]:(t=n.match(/chrome\/([\d.]+)/))?e.chrome=t[1]:(t=n.match(/opera.([\d.]+)/))?e.opera=t[1]:(t=n.match(/version\/([\d.]+).*safari/))&&(e.safari=t[1]);return e.ie?"IE "+e.ie:e.firefox?"firefox "+e.firefox:e.chrome?"chrome "+e.chrome:e.opera?"opera "+e.opera:e.safari?"safari "+e.safari:"\u672a\u77e5\u6d4f\u89c8\u5668"},c=function(){return t(new Date).utc().format("YYYY-MM-DD HH:mm:ss")},d=function(){return window.location.href},u=function(t){return"number"==typeof t},s=function(){var t="mh_"+Math.random(),e=new RegExp("(^|;)\\s*"+t+"=12345"),n=new Date(0),a=document.domain.split("."),o=[];for(o.unshift(a.pop());a.length;){o.unshift(a.pop());var i=o.join("."),r=t+"=12345;domain=."+i;if(document.cookie=r,e.test(document.cookie))return document.cookie=r+";expires="+n,i}},l=function(t){t=t||0;for(var e=[],n=0;n<t;n++)e.push("0123456789abcdef".charAt(Math.floor(16*Math.random())));return e.join("")},p=function(){return[(new Date).valueOf().toString(),l(4)].join("")},f=function(){var t=(new Date).valueOf().toString();return["4b534c46",l(4),"4"+l(3),l(4),t.substring(0,12)].join("-")},g=function(t){return t&&t.prototype&&(5===t.prototype.nodeType||"san-cmpt"===t.prototype._type)};var h=function(){function t(t){this.store=t}return t.prototype.set=function(t,e){var n;return n="[object Object]"===Object.prototype.toString.call(e)?JSON.stringify(e):e,this.store.setItem(t,n),n},t.prototype.get=function(t){return this.store.getItem(t)?function(t){if("string"==typeof t)try{var e=JSON.parse(t);return"object"==typeof e&&e}catch(t){return!1}return!1}(this.store.getItem(t))?JSON.parse(this.store.getItem(t)):this.store.getItem(t):null},t.prototype.remove=function(t){this.store.removeItem(t)},t}(),_=new h(window.localStorage),m=new h(window.sessionStorage),y=new(function(){function t(){}return t.prototype.getSessionId=function(t){switch(t){case"crossDomain":return this.getCookieSessionId();case"localStorage":return this.getLocalSessionId();default:return this.getCookieSessionId()}},t.prototype.setSessionId=function(t,e){switch(t){case"crossDomain":return this.setCookieSessionId();case"localStorage":return this.setLocalSessionId();default:return this.setCookieSessionId()}},t.prototype.getCookieSessionId=function(){var t=o.get("BCE_MONITOR_TRACK_SESSION_ID");return t&&this.setCookieSessionId(t),t},t.prototype.setCookieSessionId=function(t){var e=t||p();return o.set("BCE_MONITOR_TRACK_SESSION_ID",e,{domain:"."+s(),path:"/",expires:18e5}),e},t.prototype.getLocalSessionId=function(){return _.get("LOCAL_SESSION_ID")},t.prototype.setLocalSessionId=function(t){var e=t||p();return _.set("LOCAL_SESSION_ID",e),e},t}()),v=function(){function t(){}return t.install=function(e){t.sessionId=y.getSessionId(e.session),t.url=e.uploadUrl,t.isRequestInit=!0},t.unInstall=function(){t.isRequestInit=!1},t.trackRequest=function(e){if(t.isRequestInit){var n={actionTime:c(),context_browser:r(),context_device:"Desktop",context_os:i(),context_url:d(),campaign_track:o.get("CAMPAIGN_TRACK")},u=a(a({},n),e);t.logs.push(u),t.logs.length===t.limit&&(fetch(t.url,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8","X-Request-By":"ERApplication"},body:JSON.stringify(t.logs)}),t.logs=[])}},t.trackBehaviour=function(e){var o={};Object.keys(e).forEach((function(t){"target"===t?o[t]=e[t]:o["data_"+t]=e[t]}));var i=a({lastLogId:_.get("LOG_ID"),logId:_.set("LOG_ID",f()),page_view_id:m.get(n),sessionId:t.sessionId||p(),target:"custom",data_actionPath:window.location.href.replace(/(^.*#|~.*)/g,""),data_url:window.location.href.replace(/\?[^#]*/,"")},o);t.trackRequest(i)},t.logs=[],t.limit=5,t.url="/api/log/csi",t.sessionId=null,t.isRequestInit=!1,t}(),w=new(function(){function t(){var t=this;this.sessionId=null,this.actionHandler=function(e){t.trackBehaviour(e.type,e.currentTarget)}}return t.prototype.install=function(t){this.sessionId=y.getSessionId(t.session),this.addElementListener([document.body]),this.initAutoWatcher()},t.prototype.addElementListener=function(t){var e=this;Array.prototype.forEach.call(t,(function(t){if(t.nodeType===Node.ELEMENT_NODE){var n=t.querySelectorAll("[data-track-name]:not(a)"),a=t.getElementsByTagName("a"),o=Array.prototype.slice.call(n,0).filter((function(t){return t.getAttribute("data-track-name")&&t.getAttribute("data-track-id")})),i=Array.prototype.slice.call(a,0).filter((function(t){return t.getAttribute("data-track-name")&&t.getAttribute("data-track-id")}));e.bindListener(o),e.bindListener(i)}}))},t.prototype.initAutoWatcher=function(){var t=this;if("function"==typeof window.MutationObserver){var e,n,a,o=[],i=(e=function(e){var n=e.map((function(t){return t.addedNodes})).reduce((function(t,e){return t.concat(Array.from(e))}),[]);t.addElementListener(n),o=[]},n=500,a=null,function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null!==a&&clearTimeout(a),a=setTimeout((function(){e.apply(null,t)}),n)});new MutationObserver((function(t){o=o.concat(t),i(o)})).observe(document.body,{childList:!0,subtree:!0})}else console.log("\u4e0d\u652f\u6301 MutaionObserver")},t.prototype.bindListener=function(t){var e=this;t.forEach((function(t){var n=t.getAttribute("data-action")||"click";t.addEventListener(n,e.actionHandler)}))},t.prototype.trackBehaviour=function(t,e){var n={action:t,id:e.id||"nil",content:e.innerText.replace(/\s*/g,""),trackId:e.getAttribute("data-track-id")||"-",trackName:e.getAttribute("data-track-name")||"-",target:e.tagName.toLocaleLowerCase()};(function(t){return void 0!==t.href})(e)&&(n.href=e.href.replace(/\?[^#]*/,"")||"-"),v.trackBehaviour(n)},t}()),I=new(function(){function t(){}return t.prototype.install=function(t){},t}()),b=new(function(){function t(){}return t.prototype.install=function(t){},t}()),k=new(function(){function t(){}return t.prototype.getCurrentPage=function(){var t=this.getLastPage();return{pageId:p(),lastPageId:t&&t.pageId,module:"",time:c(),title:document.title,url:d()}},t.prototype.getLastPage=function(){return _.get("LAST_PAGE_INFO")},t.prototype.setPageData=function(t){_.set("LAST_PAGE_INFO",t),m.set("LAST_PAGE_INFO",t)},t.prototype.getPageId=function(){return m.get(n)},t}()),O=new(function(){function t(){this.sui=null,this.suiBiz=null}return t.prototype.activate=function(t,e){var n=this;this.sui=t,Object.keys(t).forEach((function(e){var a=t[e];if(g(a)){a.prototype.created=n.createdHandler.apply(n,[e]);var o=Object.keys(a);o.length>0&&o.forEach((function(t){g(a[t])&&(a[t].prototype.created=n.createdHandler.apply(n,[t]))}))}})),e&&(this.suiBiz=e,Object.keys(e).forEach((function(t){var a=e[t];if(g(a)){a.prototype.created=n.createdHandler.apply(n,[t]);var o=Object.keys(a);o.length>0&&o.forEach((function(e){g(a[e])&&(a[e].prototype.created=n.createdHandler.apply(n,[t+e]))}))}})))},t.prototype.createdHandler=function(t){var e=this;return function(){var n=e[t.toLowerCase()+"Handler"];n&&n.call(e,this)}},t.prototype.setTrackAttribute=function(t){var e=t.data.get("trackId"),n=t.data.get("trackName");e&&t.el&&t.el.setAttribute("data-track-id",e),n&&t.el&&t.el.setAttribute("data-track-name",n)},t.prototype.avatarHandler=function(t){},t.prototype.buttonHandler=function(t){var e=this;t.on("click",(function(n){e.log({target:"Button",data_action:"click",data_id:t.id,data_content:t.el.innerText.replace(/\s*/g,"")},t)}))},t.prototype.badgeHandler=function(t){},t.prototype.breadcrumbitemHandler=function(t){},t.prototype.breadcrumbHandler=function(t){},t.prototype.cascaderHandler=function(t){},t.prototype.checkboxgroupHandler=function(t){var e=this;t.on("change",(function(n){e.log({target:"CheckboxGroup",data_action:"change",data_id:t.id,data_value:n.value},t)}))},t.prototype.dialogHandler=function(t){var e=this;t.watch("open",(function(n){n&&(e.log({target:"Dialog",data_action:"open",data_id:t.id,data_title:t.data.get("title")},t),t.__openTime=Date.now())})),t.on("confirm",(function(n){e.log({target:"Dialog",data_action:"confirm",data_id:t.id,data_title:t.data.get("title"),data_lengthOfStay:Date.now()-t.__openTime},t)})),t.on("close",(function(n){e.log({target:"Dialog",data_action:"close",data_id:t.id,data_title:t.data.get("title"),data_lengthOfStay:Date.now()-t.__openTime},t)}))},t.prototype.Dropdown=function(t){},t.prototype.formHandler=function(t){},t.prototype.inputnumberHandler=function(t){var e=this;t.on("focus",(function(n){e.log({target:"InputNumber",data_action:"focus",data_id:t.id},t),t.__focusTime=Date.now()})),t.on("blur",(function(n){e.log({target:"InputNumber",data_action:"blur",data_id:t.id,data_lengthOfStay:Date.now()-t.__focusTime},t)})),t.on("enter",(function(n){e.log({target:"InputNumber",data_action:"enter",data_value:n.value,data_id:t.id},t)})),t.on("change",(function(n){e.log({target:"InputNumber",data_action:"change",data_value:n.value,data_id:t.id},t)}))},t.prototype.inputHandler=function(t){var e=this;t.on("focus",(function(n){e.log({target:"Input",data_action:"focus",data_id:t.id},t),t.__focusTime=Date.now()})),t.on("blur",(function(n){e.log({target:"Input",data_action:"blur",data_id:t.id,data_lengthOfStay:Date.now()-t.__focusTime},t)})),t.on("enter",(function(n){e.log({target:"Input",data_action:"enter",data_id:t.id,data_value:n.value},t)}))},t.prototype.iconHandler=function(t){},t.prototype.linkHandler=function(t){},t.prototype.listHandler=function(t){},t.prototype.messageHandler=function(t){},t.prototype.menuHandler=function(t){},t.prototype.notificationHandler=function(t){},t.prototype.optionGroupHandler=function(t){},t.prototype.pageHandler=function(t){},t.prototype.paginationHandler=function(t){},t.prototype.rateHandler=function(t){},t.prototype.radiogroupHandler=function(t){var e=this;t.on("change",(function(n){e.log({target:"RadioGroup",data_action:"change",data_id:t.id,data_value:n.value},t)}))},t.prototype.selectHandler=function(t){var e=this;t.on("change",(function(n){e.log({target:"Select",data_action:"change",data_id:t.id,data_value:n.value,data_content:t.data.get("selectedLabel")||""},t)})),t.watch("visible",(function(n){n?(e.log({target:"Select",data_action:"show",data_id:t.id},t),t.__focusTime=Date.now()):e.log({target:"Select",data_action:"hide",data_id:t.id,data_lengthOfStay:Date.now()-t.__focusTime},t)}))},t.prototype.sliderHandler=function(t){},t.prototype.stepsHandler=function(t){var e=this;this.log({target:"Steps",data_action:"change",data_id:t.id,data_value:t.data.get("current")},t),t.watch("current",(function(n){e.log({target:"Steps",data_action:"change",data_id:t.id,data_value:n},t)}))},t.prototype.switchHandler=function(t){var e=this;t.on("change",(function(n){e.log({target:"Switch",data_action:"change",data_id:t.id,data_value:n.value},t)}))},t.prototype.tableHandler=function(t){var e=this;t.on("sort",(function(n){e.log({target:"Table",data_action:"sort",data_id:t.id,data_order:n.value.order,data_field_name:n.value.orderBy},t)})),t.on("filter",(function(n){e.log({target:"Table",data_action:"filter",data_id:t.id,data_field_name:n.field.label,data_field_title:n.field.name,data_filter_text:n.filter.text||"",data_filter_value:n.filter.value},t)}))},t.prototype.tabsHandler=function(t){var e=this;t.on("change",(function(n){e.log({target:"Tabs",data_action:"change",data_id:t.id,data_value:n.value.label},t)}))},t.prototype.tooltipHandler=function(t){var e=this;t.watch("visible",(function(n){n&&e.log({target:"Tooltip",data_action:"active",data_id:t.id,data_content:t.data.get("content")},t)}))},t.prototype.timelineHandler=function(t){},t.prototype.timepickerHandler=function(t){},t.prototype.transferHandler=function(t){},t.prototype.triggerHandler=function(t){},t.prototype.webuploaderHandler=function(t){},t.prototype.appsidebarHandler=function(t){},t.prototype.appsidebaritemHandler=function(t){var e=this;t.on("click",(function(){e.log({target:"Sidebar",data_action:"click",data_id:t.id,data_value:t.data.get("title")},t)}))},t.prototype.applinkHandler=function(){},t.prototype.log=function(t,e){if(e&&e.el){var n=f(),o=a(a({},t),{logId:n,lastLogId:_.get("LOG_ID"),data_trackId:e.data.get("trackId"),data_trackName:e.data.get("trackName"),context_url:window.location.href.replace(/\?[^#]*/,""),data_actionPath:window.location.href.replace(/(^.*#|~.*)/g,""),page_view_id:k.getPageId(),sessionId:y.getCookieSessionId()||p()});_.set("LOG_ID",n),v.trackRequest(o)}},t}()),S=new(function(){function t(){this.isMonitorInstall=!1,this.config=e}return t.prototype.install=function(t){if(!this.isMonitorInstall){this.config=Object.assign(e,t);var n=this.config,a=n.session,o=n.autoVisual,i=n.autoHeatmap,r=n.autoTrack,c=n.uploadUrl;v.install({uploadUrl:c,session:a}),r&&w.install({session:a}),o&&window.top!==window&&I.install({}),i&&window.top!==window&&b.install({})}this.isMonitorInstall=!0},t.prototype.unInstall=function(){this.isMonitorInstall=!1,v.unInstall()},t}());return{install:S.install,trackLog:v.trackBehaviour,suiTrack:O.activate.bind(O),unInstall:S.unInstall}}));
